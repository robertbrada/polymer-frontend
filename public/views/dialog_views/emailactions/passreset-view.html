<link rel="import" href="/bower_components/polymer/polymer.html">

<link rel="import" href="/bower_components/iron-meta/iron-meta.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">

<link rel="import" href="/behaviors/dialog-validation-behavior.html">
<link rel="import" href="/behaviors/pass-visibility-behavior.html">

<link rel="import" href="/styles/dialog-styles.html">
<link rel="import" href="/styles/button-styles.html">

<dom-module id="passreset-view">
    <template>
        <style include="dialog-styles button-styles">
        </style>
        <iron-meta id="meta"></iron-meta>

        <p>Prosím zadejte nové heslo:</p>
        <paper-input id="passID" value="{{password}}" label="Nové heslo" required auto-validate
                     type="password"
                     minlength="6" maxlength="48" error-message="Moc krátké" on-blur="checkIfValid">
            <paper-icon-button icon="[[eyeIcon]]" on-tap="passVisibilityChange" suffix></paper-icon-button>
        </paper-input>
        <paper-button responsive id="confirm_button" autofocus on-tap="confirm">
            Změnit heslo
        </paper-button>

        <paper-icon-button dialog-dismiss icon="close" id="closeBtn"></paper-icon-button>
    </template>

    <script>
        Polymer({
            is: 'passreset-view',

            behaviors: [DialogValidationBehavior, PassVisibilityBehavior],

            validationIDs: ["passID"],

            confirmFunction: function () {
                return this.resetPassword.bind(this);
            },

            resetPassword: function () {
                var auth = document.getElementById('appID').app.auth();
                auth.confirmPasswordReset(this.$.meta.byKey('actionCode'), this.password).then(function () {
                    // TODO: bug fix. Following toast doesn't show.
                    this.fire("show-toast", {text: "Heslo změněno"});
                }.bind(this)).catch(function (error) {
                    console.log(error);
                })
            }
        });
    </script>
</dom-module>
