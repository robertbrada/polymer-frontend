<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="emailaction-view">
    <template>
        <style>
        </style>
    </template>

    <script>
        Polymer({
            is: 'emailaction-view',

            ready: function () {

                var actionCode = this.tail.__queryParams["oobCode"];

                var auth = this.domHost.$.auth.app.auth(); // TODO: find less retarded way to get reference

                switch (this.tail.__queryParams["mode"]) {
                    case 'resetPassword':
                        this.handleResetPassword(auth, actionCode);
                        break;
                    case 'recoverEmail':
                        this.handleRecoverEmail(auth, actionCode);
                        break;
                    case 'verifyEmail':
                        this.handleVerifyEmail(auth, actionCode);
                        break;
                    default:
                        this.domHost.changeRoute('/home');
                        this.domHost.showDialog("actionerror");
                }
            },

            handleResetPassword: function () {
                console.log("Handle reset password");
            },

            handleRecoverEmail: function () {
                console.log('Handle recover email');
            },

            handleVerifyEmail: function (auth, actionCode) {
                console.log('Handle email verification');
                var toast = this.domHost.$.main_toast;
                auth.applyActionCode(actionCode).then(function (response) {
                    toast.text = "Email potvrzen";
                    toast.open();
                }.bind(this)).catch(function (error) {
                    // Open dialog with resend button
                    console.log(error);
                });
            }
        });
    </script>
</dom-module>
