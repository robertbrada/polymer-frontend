<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="/bower_components/paper-input/paper-textarea.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/gold-email-input/gold-email-input.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="/bower_components/polymerfire/firebase-app-script.html">
<link rel="import" href="/bower_components/iron-form/iron-form.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">

<link rel="import" href="/styles/input-styles.html">
<link rel="import" href="/styles/layout-styles.html">
<link rel="import" href="/styles/button-styles.html">

<dom-module id="docinfo-view">
    <template>
        <style include="button-styles layout-styles input-styles">
            :host {
                display: block;
                color: #252526;
            }

            .green {
                background-color: var(--app-green-color);
                color: #fff !important;
            }

            a {
                text-decoration: none;
            }

            .regular-link {
                display: block;
                color: var(--app-accent-color);
                font-weight: 400;
                margin-top: 3em;
            }

            .regular-link iron-icon {
                color: var(--app-green-color);
                margin-top: -4px;
            }

            .regular-link:hover {
                text-decoration: underline;
            }

            h1 {
                letter-spacing: 0.02em;
                font-size: 1.6em;
                margin-top: 0;
                margin-bottom: 1.4em;
            }

            paper-button, .styled-link {
                transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
                box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
            }

            .main-frame {
                max-width: 1350px;
                font-weight: lighter;
                padding: 0;
                margin: 0 auto;
            }

            .grid section {
                padding: 4.5em 5%;
                margin: 0 !important;
                position: relative;
            }

            section > p {
                font-size: 1.2em;
                line-height: 1.65em;
            }

            header {
                background: var(--app-accent-color) url("../images/docinfo/header-shadow.png");
                background-size: cover;
                color: #fff;
                text-align: center;
                padding-bottom: 3em;
                padding-top: 1em;
            }

            header > section {
                max-width: 1300px;
                margin: 0 auto;
                text-align: left;
            }

            header h1 {
                font-size: 1.95em;
                margin-bottom: 2em;
                letter-spacing: 0.03em;
            }

            header .image-section {
                text-align: right;
            }

            header paper-button {
                padding: 1.5em 2.5em;
                font-weight: bold;
                letter-spacing: 0.08em;
            }

            .register-container {
                text-align: center;
                position: relative;
            }

            .register-container paper-button {
                padding: 1.6em 2.6em;
                font-weight: bold;
                font-size: 1.1em;
                letter-spacing: 0.08em;
            }

            .register-container p {
                font-size: 1.1em;
                font-weight: 300;
                color: #808081;
                max-width: 550px;
                margin: 2em auto 1em auto;
                padding: 0 1em;
            }

            #headline-arrow {
                color: var(--app-green-color);
                height: 23px;
                width: auto;
                margin-right: 0.5em;
            }

            #header-image {
                max-width: 400px;
                margin-top: 5em;
            }

            header .arrow {
                max-height: 26px;
                position: absolute;
                top: calc(50% - 15px);
                left: calc(50% - 12em);
            }

            /************************/
            #discover-more-container {
                text-align: center;
                margin: 2em auto 3em auto;
            }

            #discover-more-container h2 {
                color: var(--app-grey-text-color);
                font-weight: 300;
                font-size: 1.5em;
                margin: 1em auto 0.6em 0;
            }

            #discover-arrow {
                max-width: 26px;
            }

            /******************/

            #office-calendar-main-section {
                margin-bottom: 0;
                padding-top: 2em;
            }

            #online-booking-arrow {
                max-height: 90px;
                position: absolute;
                right: 40%;
                top: -2em;
            }

            /********************/
            #patients-main-container {
                position: relative;
                margin-top: 0;
                padding-top: 3em;
                padding-bottom: 3em;
            }

            #patients-main-container .main-frame {
                border-bottom: 1px solid #e2e2e3;
            }

            #patients-main-container .styled-link {
                display: block;
                text-align: center;
            }

            #patients-image {
                max-height: 200px;
                width: auto;
            }

            /***************/

            #about-section {
                border-bottom: 1px solid #e2e2e3;
                border-top: 1px solid #e2e2e3;
                background-color: #fbfbfc;
            }

            /****************/

            #bottom-registration-container h1 {
                color: var(--app-accent-color);
                font-size: 1.4em;
                margin-top: 2em;
            }

            .presentation-img {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                margin: auto;
            }

            #comp-img {
                margin-left: 0;
                margin-bottom: 0;
                max-width: 560px;
                max-height: 560px;
            }

            .img-section {
                text-align: center;
            }

            /*** ABOUT ***/

            #profile-images-section {
                margin-left: 5em;
                max-width: 160px;
                padding-left: 5em;
                padding-right: 5em;
                border-left: 1px solid #e2e2e3;
            }

            .profile-image {
                position: static;
                max-width: 150px;
                max-height: 150px;
            }

            #about-section {
                margin-bottom: 0;
            }

            /***** OFFICE PRESENTATION ********/

            .styled-link {
                font-weight: bold;
                background-color: var(--app-green-color);
                color: #fff;
                padding: 0.5em 1em;
                border-radius: 2em;
                letter-spacing: 0.02em;
            }

            /*** QUESTION FORM ***/

            #question-container {
                background-color: #fbfbfc;
                margin-top: 3em;
                padding: 3em 1.5em;
                border-top: 1px solid #e2e2e3;
            }

            #question-container h2 {
                font-size: 1.5em;
                letter-spacing: 0.02em;
                margin-top: 0.5em;

            }

            form {
                max-width: 500px;
                margin: 0 auto;
            }

            #office-presence-main-section {
                margin-top: 4em;
                margin-bottom: 4em;
            }

            #settings-img {
                max-height: 480px;
                max-width: 480px;
            }

            .features-section > div {
                margin: 0.7em 0;
            }

            .features-section p {
                display: inline-block;
                text-align: left;
            }

            @media (max-width: 1200px) {
                #comp-img {
                    max-width: 450px;
                    max-height: 450px;
                }

                #settings-img {
                    max-width: 350px;
                    max-height: 350px;
                }

                header .image-section {
                    text-align: center;
                }

                header h1 {
                    font-size: 1.6em;
                }

                #headline-arrow {
                    height: 13px;
                }

                #header-image {
                    max-width: 280px;
                    margin-top: 5em;
                }
            }

            @media (max-width: 716px) {

                :host {
                    font-size: 0.85em;
                }

                .grid section {
                    padding: 7% 5%;
                }

                .presentation-img {
                    position: static;
                    max-width: 150px;
                    max-height: 150px;
                }

                #profile-images-section {
                    margin: 0;
                    padding-left: 0;
                    padding-right: 0;
                    border: none;
                    text-align: center;
                    max-width: 100%;
                }

                #online-booking-arrow {
                    max-height: 60px;
                }

            }

            @media (max-width: 980px) {

                #office-calendar-main-section {
                    padding-top: 0;
                }
            }

            @media (min-width: 767px) {

                paper-button:hover {
                    transform: scale(1.1);
                    box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
                }

                .styled-link:hover {
                    box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
                }
            }

            /******** HEADER ANIMATIONS ************/

            /*Vertical Sliding*/
            .slidingVertical {
                display: inline;
            }

            .slidingVertical span {

                /*on all browsers*/
                animation: topToBottom 15.2s linear infinite 0s;
                -ms-animation: topToBottom 15.2s linear infinite 0s;
                -webkit-animation: topToBottom 15.2s linear infinite 0s;

                opacity: 0;
                overflow: hidden;
                position: absolute;
            }

            .slidingVertical span:nth-child(2) {
                animation-delay: 3.8s;
                -ms-animation-delay: 3.8s;
                -webkit-animation-delay: 3.8s;
            }

            .slidingVertical span:nth-child(3) {
                animation-delay: 7.6s;
                -ms-animation-delay: 7.6s;
                -webkit-animation-delay: 7.6s;
            }

            .slidingVertical span:nth-child(4) {
                animation-delay: 11.4s;
                -ms-animation-delay: 11.4s;
                -webkit-animation-delay: 11.4s;
            }

            /*topToBottom Animation on all browsers*/
            @-moz-keyframes topToBottom {
                0% {
                    opacity: 0;
                }
                5% {
                    opacity: 0;
                    -moz-transform: translateY(-50px);
                }
                10% {
                    opacity: 1;
                    -moz-transform: translateY(0px);
                }
                25% {
                    opacity: 1;
                    -moz-transform: translateY(0px);
                }
                30% {
                    opacity: 0;
                    -moz-transform: translateY(50px);
                }
                80% {
                    opacity: 0;
                }
                100% {
                    opacity: 0;
                }
            }

            @-webkit-keyframes topToBottom {
                0% {
                    opacity: 0;
                }
                5% {
                    opacity: 0;
                    -webkit-transform: translateY(-50px);
                }
                10% {
                    opacity: 1;
                    -webkit-transform: translateY(0px);
                }
                25% {
                    opacity: 1;
                    -webkit-transform: translateY(0px);
                }
                30% {
                    opacity: 0;
                    -webkit-transform: translateY(50px);
                }
                80% {
                    opacity: 0;
                }
                100% {
                    opacity: 0;
                }
            }

            @-ms-keyframes topToBottom {
                0% {
                    opacity: 0;
                }
                5% {
                    opacity: 0;
                    -ms-transform: translateY(-50px);
                }
                10% {
                    opacity: 1;
                    -ms-transform: translateY(0px);
                }
                25% {
                    opacity: 1;
                    -ms-transform: translateY(0px);
                }
                30% {
                    opacity: 0;
                    -ms-transform: translateY(50px);
                }
                80% {
                    opacity: 0;
                }
                100% {
                    opacity: 0;
                }
            }

        </style>

        <iron-media-query query="max-width:460px" query-matches="{{mobileScreen}}"></iron-media-query>
        <iron-media-query query="max-width:716px" query-matches="{{smallScreen}}"></iron-media-query>
        <iron-media-query query="max-width:980px" query-matches="{{mediumScreen}}"></iron-media-query>

        <header>
            <section id="" class="grid">
                <section>
                    <h1><img src="../images/docinfo/headline-arrow.png" id="headline-arrow">
                        <div class="slidingVertical">
                            <span>INOVUJEME ZDRAVOTNICTVÍ</span>
                            <span>PROPOJUJEME LÉKAŘE S PACIENTY</span>
                            <span>PŘIDEJTE SE K NÁM</span>
                            <span>ŽÁDNÉ SMLOUVY ANI ZÁVAZKY</span>
                            <!--<span>STAŇTE SE SOUČÁSTÍ NĚČEHO NOVÉHO</span>-->
                            <!--<span>TVOŘÍME SLUŽBY PRO VŠECHNY</span>-->
                            <!--<span>STAČÍ SE JEN REGISTROVAT</span>-->
                        </div>
                    </h1>
                    <p>
                        Docta.cz je unikátní projekt, který umožňuje všem lékařům
                        zapojit se do elektronizace zdravotnictví.
                    </p>
                    <p>
                        Jedná se o nastupující trend, jak zefektivnit zdravotnictví a interakci
                        mezi lékaři a pacienty. Ušetříte tak čas a práci sobě i ostatním.
                    </p>
                    <p>
                        Lékaři by neměli být vázáni smlouvami ani platit za služby, které
                        zlepšují zdravotní péči. Proto je vše, co nabízíme, zdarma.
                        <br>Stačí se jen Zaregistrovat.
                    </p>
                </section>

                <section class="image-section" hidden="[[smallScreen]]">
                    <img src="../images/docinfo/header.png" id="header-image" hidden="[[smallScreen]]">
                </section>
            </section>

            <div class="register-container">
                <img src="../images/docinfo/horizontal-white-arrow.png" class="arrow" hidden="[[mobileScreen]]">
                <a href="[[computeUrl(signedIn)]]">
                    <paper-button raised>[[computeButtonText(signedIn)]]</paper-button>
                </a>
            </div>

        </header>

        <section id="about-section">
            <div class="main-frame grid">
                <section>
                    <h1>PROČ TO DĚLÁME?</h1>
                    <p>
                        Je rok 2017 a už 10 let existuje konkurence, která nabízí podobné služby co my. Místo toho, aby
                        se snažili uspokojit co nejvíc zákazníků, tak vybírají poplatky a zavazují smlouvami ke službám,
                        které by měly být samozřejmostí. Tím brzdí vývoj a odrazují lékaře od služeb, které jsou
                        prospěšné pro nás všechny.

                    </p>
                    <p>
                        Kvalita zdravotní péče ovlivňuje každého z nás, a proto jsme si dali za cíl vytvořit tento
                        veřejný systém.
                    </p>
                </section>
                <section id="profile-images-section" class="">
                    <img src="../images/docinfo/jan.jpg" class="profile-image">
                    <img src="../images/docinfo/robert.jpg" class="profile-image">
                </section>
            </div>
        </section>

        <div id="discover-more-container">
            <h2>Prohlídka systému</h2>
            <img src="../images/docinfo/vertical-green-arrow.png" id="discover-arrow">
        </div>


        <section id="office-presence-main-section">
            <div class="main-frame grid">
                <section id="office-presence-section">
                    <h1>KOMPLETNÍ PREZENTACE ORDINACE</h1>
                    <p>Nabízíme Vám možnost prezentovat všechny důležité informace
                        o Vaší ordinaci na internetu. </p>
                    <p>
                        Nemusíte si platit za vlastní stránky. K dispozici máte přehledné nastavení
                        ordinace, kde můžete kdykoli měnit informace o Vaší ordinaci.
                        <br>
                        <br>
                        <a class="styled-link" href="/d/strakova_plzen">Zobrazit ukázkový profil</a>
                        <a class="regular-link" href="/newweb">
                            <iron-icon icon="icons:star"></iron-icon>
                            Profil zdarma Vám nestačí a chcete vlastní stránky?</a>
                    </p>
                </section>

                <section class="img-section" hidden="[[mediumScreen]]">
                    <img id="settings-img" class="" src="../images/docinfo/settings.png">
                </section>
            </div>
        </section>

        <section class="green" id="office-calendar-main-section">
            <div class="main-frame grid">
                <section class="img-section" hidden="[[mediumScreen]]">
                    <img id="comp-img" class="presentation-img" src="../images/docinfo/calendar.png">
                </section>
                <section id="office-calendar-section">
                    <h1>ONLINE OBJEDNÁVÁNÍ<br>A ELEKTRONICKÝ KALENDÁŘ</h1>
                    <p>K dispozici máte online objednávání, které můžete využít jakkoli se Vám to hodí. Je jedno kolik
                        objednávacích dnů nebo časů si
                        vytvoříte,
                        za nic platit nebudete.
                    </p>
                    <p>Elektronický kalendář přehledně reprezentuje Vaše objednané pacienty. Můžete v něm snadno
                        objednávat nebo rušit schůzky.</p>
                </section>
            </div>
        </section>

        <section class="" id="patients-main-container">
            <img id="online-booking-arrow" src="../images/docinfo/online_booking_arrow.png">
            <div class="main-frame grid">
                <section>
                    <h1>KONTROLUJTE SI SAMI, KDO SE K VÁM MŮŽE OBJEDNAT</h1>
                    <p>Nemusíte se obávat, že se k Vám objedná kdokoli. Pokud budete chtít,
                        máte k dispozici potvrzování pacientů.
                    </p>
                    <p>
                        Můžete si tak sami vybrat, kteří pacienti se mohou objednat a kteří ne. Tím si vytvoříte seznam
                        Vašich pacientů, kterým můžete
                        důvěřovat.
                        <br>
                        <br>
                        <br>
                        <a class="styled-link" href="/newweb">Zaujaly Vás naše služby, ale chcete vlastní stránky?</a>
                    </p>
                </section>
                <section class="img-section">
                    <img id="patients-image" src="../images/docinfo/patients.png">
                </section>
            </div>

            <div id="bottom-registration-container" class="register-container">
                <h1>PRO VYUŽITÍ VŠECH SLUŽEB SE ZAREGISTRUJTE</h1>
                <a href="[[computeUrl(signedIn)]]">
                    <paper-button raised>[[computeButtonText(signedIn)]]</paper-button>
                </a>
                <p>* Naše služby neustále zlepšujeme a rozšiřujeme, systém má sloužit Vám.
                    Proto pokud máte jakýkoli návrh na zlepšení, neváhejte se nám ozvat. </p>
            </div>
        </section>

        <div id="question-container" hidden="[[messageSent]]">
            <form id="docinfo_form" is="iron-form">
                <h2>Napište nám</h2>
                <gold-email-input id="email_input" error-message="Špatný formát"
                                  label="Vaše emailová adresa" required>
                </gold-email-input>
                <paper-textarea id="message_input" label="Vaše zpráva" char-counter
                                error-message="Zpráva nesmí být prázdná"
                                maxlength="2000" required></paper-textarea>
                <paper-button raised on-tap="send">Odeslat</paper-button>
            </form>
        </div>
    </template>

    <script>
        Polymer({
            is: 'docinfo-view',

            properties: {
                messageSent: {
                    type: Boolean,
                    value: false
                },

                id: {
                    type: String
                },

                ip: {
                    type: String,
                    value: null
                }
            },

            observers: [
                "routePathObserver(route)"
            ],

            ready: function () {
                var xhr = new XMLHttpRequest(),
                    setIp = function (e) {
                        if (xhr.readyState == 4 && xhr.status == 200) {
                            var response = JSON.parse(xhr.responseText);
                            this.ip = response.ip;
                            // Catch first visit
                            if (!!this.route) {
                                this.routePathObserver(this.route);
                            }
                        }
                    }.bind(this);

                xhr.open('GET', "//ipinfo.io/json", true);
                xhr.send();
                xhr.addEventListener("readystatechange", setIp, false);
            },

            routePathObserver: function (route) {
                var path = route.path,
                    objectToSave = {};

                if (!(!!this.id)) {
                    if (route.prefix === "/docinfo" && path.length > 1) {
                        this.id = path.substring(1);
                    } else if (!!this.ip) {
                        this.id = this.ip.replace(/[.]/g, "-");
                    }
                }

                if (!!this.id) {
                    objectToSave["URL"] = route.prefix + route.path;
                    objectToSave["datetime"] = new Date().toString();
                    objectToSave["ip"] = this.ip;
                    firebase.apps[0].database().ref("/docInfoVisitors/" + this.id).push(objectToSave);
                }

            },

            send: function () {
                //  paper-textarea was not detected by form validation, so I'm validating the inputs manually
                if (this.$.email_input.validate() && this.$.message_input.validate()) {
                    this.sendQuestion();
                }
            },

            sendQuestion: function () {

                var email = this.$.email_input.value,
                    message = this.$.message_input.value,
                    db = firebase.apps[0].database();

                db.ref('/docInfoQuestions/').push({
                    "email": email,
                    "message": message
                }).then(function () {
                    this.fire("show-toast", {text: "Zpráva odeslána"});
                    this.messageSent = true;
                }.bind(this), function () {
                    this.fire("show-dialog", {
                        path: "", viewName: "genericdialog", open: true,
                        data: {
                            text: 'Při ukládání dat se vyskytla chyba. Zkuste to prosím znovu.',
                            buttonText: 'Zavřít'
                        }
                    });
                }.bind(this));
            },

            computeUrl: function (signedIn) {
                return (signedIn) ? "/office/registration/first" : "/registration/doc";
            },

            computeButtonText: function (signedIn) {
                return (signedIn) ? "Přidat ordinaci" : "Zaregistrovat se";
            }
        });
    </script>
</dom-module>
