<link rel="import" href="/bower_components/polymer/polymer.html">

<link rel="import" href="/bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/bower_components/iron-pages/iron-pages.html">
<link rel="import" href="/bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="/bower_components/neon-animation/animations/fade-out-animation.html">

<link rel="import" href="/bower_components/iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">

<dom-module id="main-dialog">
    <template>
        <style>
            @media only screen and (min-width: 767px) {
                #dialogID {
                    max-width: 500px;
                    padding: 30px 50px 0 50px;
                }
            }

            @media only screen and (max-width: 767px) {
                #dialogID {
                    position: fixed;
                    margin: 0;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;

                    width: 100%;
                }
            }
        </style>

        <paper-dialog id="dialogID" with-backdrop entry-animation="scale-up-animation"
                      exit-animation="fade-out-animation">
            <iron-pages id="main_pages" selected="{{viewName}}" attr-for-selected="name">
                <login-view name="login"></login-view>
                <registration-view name="registration"></registration-view>
                <emaildialog-view name="emaildialog"></emaildialog-view>
                <actionerror-view name="actionerror"></actionerror-view>
                <actionconfirm-view name="actionconfirm"></actionconfirm-view>
                <passreset-view name="passreset"></passreset-view>
                <emailinput-view name="emailinput"></emailinput-view>
            </iron-pages>
        </paper-dialog>
    </template>

    <script>
        Polymer({
            is: 'main-dialog',

            behaviors: [Polymer.IronA11yKeysBehavior],

            properties: {
                viewName: {
                    type: String,
                    value: "login",
                },

                keyEventTarget: {
                    type: Object,
                    value: function () {
                        return document.body;
                    }
                }
            },

            keyBindings: {
                'enter:keypress': '_passConfirmation',
            },

            listeners: {
                'dialog-confirm': '_dialogConfirm',
            },

            _passConfirmation: function () {
                this.$.main_pages.selectedItem.confirm();
            },

            _showDialog: function (event) {
                this.viewName = event.detail.viewName;
                this.importHref("/views/dialog_views/" + event.detail.path + event.detail.viewName + "-view.html", function () {
                    if (event.detail.open) {
                        this.$.dialogID.toggle();
                    }
                }.bind(this), null, true);
            },

            _dialogConfirm: function (event) {
                this.$.dialogID.close();
                event.stopPropagation ? event.stopPropagation() : (event.cancelBubble = true);
            }

        });
    </script>
</dom-module>
